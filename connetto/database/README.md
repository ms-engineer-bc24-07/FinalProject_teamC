my-project/
├── database/                          # データベース関連全般
│   ├── tables/                        # テーブル定義やスキーマの管理
│   │   ├── 001_create_user_table.sql  # ユーザーテーブル作成スクリプト
│   │   ├── 002_create_meetup_table.sql# ミートアップテーブル作成スクリプト
│   │   └── 003_create_preferences_table.sql # 希望条件テーブル作成スクリプト
│   ├── migrations/                    # マイグレーション関連（テーブル変更・追加）
│   │   ├── v1/                        # バージョン1のマイグレーション（初期設定）
│   │   │   ├── 001_add_indexes.sql   # インデックス作成
│   │   │   └── 002_add_foreign_keys.sql # 外部キー追加
│   │   └── v2/                        # バージョン2のマイグレーション（アップデート）
│   │       ├── 001_add_new_column_to_user.sql # 新しいカラム追加
│   │       └── 002_drop_unnecessary_column.sql # 不要なカラム削除
│   ├── views/                         # ビュー定義（データ抽出用）
│   │   ├── user_view.sql              # ユーザー情報ビュー
│   │   ├── meetup_view.sql            # ミートアップ情報ビュー
│   │   └── preference_view.sql        # 希望条件ビュー
│   ├── stored_procedures/             # ストアドプロシージャ（関数）
│   │   ├── calculate_match_score.sql  # マッチスコア計算関数
│   │   ├── generate_meetup_group.sql  # ミートアップグループ生成
│   │   └── notify_user_about_meetup.sql # ミートアップ通知
│   ├── triggers/                      # トリガー（自動処理）
│   │   ├── update_timestamp_trigger.sql # タイムスタンプ更新トリガー
│   │   └── log_user_action_trigger.sql # ユーザーアクションログのトリガー
│   ├── secrets/                       # 環境変数や暗号化キー
│   │   ├── .env                       # 環境設定ファイル（DB接続情報など）
│   │   └── secret.key                 # 暗号化キーなど
│   ├── backups/                       # データベースバックアップ
│   │   ├── backup_2024-11-20.sql      # バックアップファイル
│   │   └── restore_2024-11-21.sql     # リストア用SQLファイル
│   ├── logs/                          # データベース関連のログファイル
│   │   ├── db_error_log.txt           # エラーログ
│   │   └── db_query_log.txt           # クエリログ
│   ├── data_imports/                  # データインポート用スクリプト（CSVや外部データ）
│   │   ├── import_initial_data.sql    # 初期データインポート用
│   │   └── import_user_data.sql       # ユーザーデータのインポートスクリプト
│   └── README.md                      # データベース設計・運用ガイド

ファイル名の先頭に番号（例えば、001、002）を付ける理由は、マイグレーションの順序を明確に管理するためです。

1. マイグレーションの順序管理
データベースのスキーマを変更する際、テーブルの作成や変更、インデックスの追加などの操作を行います。これらは順番に実行する必要があります。例えば、最初にユーザーテーブルを作成し、その後でミートアップテーブルを作成するというように、順番が決まっています。
番号を付けることで、マイグレーションファイルが実行される順番を自然に管理できるようになります。番号が小さい順に実行されるため、依存関係を考慮した実行順序が保証されます。
2. マイグレーションのバージョン管理
番号を付けることで、どのマイグレーションがどのバージョンに対応しているかを簡単に把握できます。新しいテーブルを追加したり、変更を加えたりするたびに番号を増やすことで、各バージョンのスキーマがどう変わったのかが一目でわかるようになります。
例えば、最初に001_create_user_table.sqlを適用し、その後002_create_meetup_table.sql、さらに003_create_preferences_table.sqlを適用することで、スキーマが進化していく様子を追うことができます。
3. スクリプトの衝突を防ぐ
複数の開発者が同時に作業している場合、マイグレーションスクリプトの命名が衝突することがあります。番号を付けておくことで、誰がどのスクリプトを作成したのかが分かりやすく、また、衝突を避けるための手助けになります。
4. 再適用やロールバックが簡単
マイグレーションが適用されていない場合、番号が小さいものから順に適用されるため、スクリプトの適用管理が簡単になります。また、ロールバックする際にも番号で管理できるため、何を戻すべきかを特定しやすくなります。